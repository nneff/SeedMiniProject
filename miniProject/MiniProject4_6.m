clear
set(0,'DefaultLineLineWidth',1.2)

% K and sigma were determined using the experimental step response data from
% the velocity vs. time plot. K was set equal to the steady state value of
% the velocity response. Sigma was found by calculating the time at which
% the value of velocity was equal to 64% of the steady state value. This
% gave an estimate of the transfer function used to model this system.
K = 1.50;
sig = 7.142;

%EXPERIMENTAL DATA
% This is the data obtained in the serial monitor from running the open
% loop step response experiment with the Arduino.
time = [1004 1009 1014 1019 1024 1029 1034 1039 1044 1049 1054 1059 1064 1069 1074 1079 1084 1089 1094 1099 1104 1110 1115 1120 1125 1130 1135 1140 1145 1150 1155 1160 1165 1170 1175 1180 1185 1190 1195 1200 1205 1210 1215 1220 1225 1230 1235 1240 1245 1250 1255 1260 1265 1270 1275 1280 1285 1290 1295 1300 1305 1310 1315 1320 1325 1330 1335 1340 1345 1350 1355 1360 1366 1371 1376 1381 1386 1391 1396 1401 1406 1411 1416 1421 1426 1431 1436 1441 1446 1451 1456 1461 1466 1471 1476 1481 1486 1491 1496 1501 1506 1511 1516 1521 1526 1531 1536 1541 1546 1551 1556 1561 1566 1571 1576 1581 1586 1591 1596 1601 1606 1611 1616 1622 1627 1632 1637 1642 1647 1652 1657 1662 1667 1672 1677 1682 1687 1692 1697 1702 1707 1712 1717 1722 1727 1732 1737 1742 1747 1752 1757 1762 1767 1772 1777 1782 1787 1792 1797 1802 1807 1812 1817 1822 1827 1832 1837 1842 1847 1852 1857 1862 1867 1872 1878 1883 1888 1893 1898 1903 1908 1913 1918 1923 1928 1933 1938 1943 1948 1953 1958 1963 1968 1973 1978 1983 1988 1993 1998 2003 2008 2013 2018 2023 2028 2033 2038 2043 2048 2053 2058 2063 2068 2073 2078 2083 2088 2093 2098 2103 2108 2113 2118 2123 2128 2134 2139 2144 2149 2154 2159 2164 2169 2174 2179 2184 2189 2194 2199 2204 2209 2214 2219 2224 2229 2234 2239 2244 2249 2254 2259 2264 2269 2274 2279 2284 2289 2294 2299 2304 2309 2314 2319 2324 2329 2334 2339 2344 2349 2354 2359 2364 2369 2374 2379 2384 2390 2395 2400 2405 2410 2415 2420 2425 2430 2435 2440 2445 2450 2455 2460 2465 2470 2475 2480 2485 2490 2495 2500 2505 2510 2515 2520 2525 2530 2535 2540 2545 2550 2555 2560 2565 2570 2575 2580 2585 2590 2595 2600 2605 2610 2615 2620 2625 2630 2635 2640 2646 2651 2656 2661 2666 2671 2676 2681 2686 2691 2696 2701 2706 2711 2716 2721 2726 2731 2736 2741 2746 2751 2756 2761 2766 2771 2776 2781 2786 2791 2796 2801 2806 2811 2816 2821 2826 2831 2836 2841 2846 2851 2856 2861 2866 2871 2876 2881 2886 2891 2896 2902 2907 2912 2917 2922 2927 2932 2937 2942 2947 2952 2957 2962 2967 2972 2977 2982 2987 2992 2997];
time = (time./1000)-1;
posAngular = [0.00 0.00 0.00 0.00 0.00 0.01 0.01 0.02 0.02 0.03 0.03 0.04 0.04 0.05 0.05 0.06 0.06 0.07 0.07 0.08 0.09 0.09 0.10 0.11 0.11 0.12 0.13 0.14 0.14 0.15 0.16 0.16 0.17 0.18 0.18 0.19 0.20 0.21 0.22 0.22 0.23 0.24 0.24 0.25 0.26 0.27 0.27 0.28 0.29 0.29 0.30 0.31 0.32 0.33 0.33 0.34 0.35 0.35 0.36 0.37 0.37 0.38 0.39 0.40 0.40 0.41 0.42 0.43 0.44 0.44 0.45 0.46 0.46 0.47 0.48 0.49 0.49 0.50 0.51 0.52 0.53 0.53 0.54 0.55 0.56 0.57 0.57 0.58 0.59 0.59 0.60 0.61 0.62 0.62 0.63 0.64 0.65 0.66 0.66 0.67 0.68 0.68 0.69 0.70 0.71 0.71 0.72 0.73 0.74 0.75 0.75 0.76 0.77 0.78 0.79 0.79 0.80 0.81 0.82 0.82 0.83 0.84 0.85 0.86 0.86 0.87 0.88 0.89 0.90 0.90 0.91 0.92 0.93 0.93 0.94 0.95 0.96 0.97 0.97 0.98 0.99 0.99 1.00 1.01 1.02 1.02 1.03 1.04 1.05 1.06 1.06 1.07 1.08 1.09 1.10 1.10 1.11 1.12 1.12 1.13 1.14 1.14 1.15 1.16 1.17 1.17 1.18 1.19 1.19 1.20 1.21 1.22 1.23 1.23 1.24 1.24 1.25 1.26 1.27 1.27 1.28 1.29 1.30 1.30 1.31 1.32 1.32 1.33 1.34 1.34 1.35 1.36 1.36 1.37 1.38 1.39 1.39 1.40 1.41 1.42 1.42 1.43 1.44 1.45 1.45 1.46 1.47 1.48 1.48 1.49 1.50 1.50 1.51 1.52 1.53 1.54 1.54 1.55 1.56 1.56 1.57 1.58 1.59 1.59 1.60 1.61 1.62 1.63 1.63 1.64 1.65 1.66 1.67 1.67 1.68 1.68 1.69 1.70 1.70 1.71 1.72 1.73 1.73 1.74 1.75 1.75 1.76 1.77 1.77 1.78 1.79 1.79 1.80 1.81 1.81 1.82 1.83 1.83 1.84 1.85 1.85 1.86 1.87 1.87 1.88 1.89 1.89 1.90 1.91 1.91 1.92 1.93 1.94 1.94 1.95 1.96 1.96 1.97 1.98 1.98 1.99 1.99 2.00 2.01 2.01 2.02 2.03 2.03 2.04 2.05 2.05 2.06 2.07 2.07 2.08 2.08 2.09 2.10 2.10 2.11 2.11 2.12 2.12 2.13 2.14 2.14 2.15 2.16 2.16 2.17 2.18 2.18 2.19 2.20 2.20 2.21 2.21 2.22 2.23 2.23 2.24 2.25 2.25 2.26 2.27 2.27 2.28 2.29 2.30 2.31 2.31 2.32 2.33 2.33 2.34 2.35 2.36 2.36 2.37 2.38 2.38 2.39 2.40 2.41 2.41 2.42 2.43 2.43 2.44 2.45 2.46 2.47 2.47 2.48 2.49 2.49 2.50 2.51 2.52 2.53 2.53 2.54 2.54 2.55 2.56 2.57 2.58 2.58 2.59 2.60 2.60 2.61 2.62 2.63 2.64 2.64 2.65 2.66 2.67 2.67 2.68 2.69 2.70 2.71 2.71 2.72 2.73 2.73 2.74 2.75 2.76 2.76 2.77 2.78 2.79 2.80 2.80 2.81];
v = [0.00 0.00 0.00 0.00 0.16 0.27 0.35 0.40 0.45 0.48 0.58 0.60 0.61 0.63 0.64 0.70 0.70 0.75 0.79 0.79 0.83 0.82 0.85 0.88 0.91 0.91 0.93 0.95 0.97 0.97 0.99 1.01 1.02 1.02 1.03 1.05 1.06 1.07 1.09 1.10 1.11 1.12 1.11 1.12 1.13 1.14 1.15 1.16 1.17 1.18 1.17 1.18 1.19 1.19 1.20 1.21 1.21 1.22 1.22 1.23 1.24 1.24 1.25 1.24 1.24 1.25 1.25 1.26 1.26 1.27 1.27 1.28 1.28 1.28 1.27 1.29 1.28 1.29 1.29 1.29 1.30 1.30 1.30 1.31 1.31 1.31 1.32 1.32 1.32 1.32 1.33 1.33 1.33 1.33 1.34 1.34 1.34 1.34 1.34 1.34 1.34 1.35 1.35 1.36 1.36 1.36 1.36 1.36 1.36 1.36 1.36 1.36 1.37 1.37 1.37 1.37 1.37 1.38 1.38 1.38 1.38 1.38 1.38 1.38 1.38 1.39 1.39 1.39 1.39 1.39 1.39 1.39 1.40 1.40 1.40 1.40 1.40 1.40 1.40 1.40 1.41 1.41 1.40 1.40 1.40 1.41 1.41 1.41 1.41 1.41 1.41 1.41 1.41 1.41 1.42 1.42 1.42 1.42 1.42 1.42 1.42 1.42 1.42 1.42 1.42 1.43 1.43 1.43 1.43 1.43 1.43 1.43 1.43 1.43 1.43 1.43 1.43 1.43 1.43 1.44 1.44 1.44 1.44 1.44 1.44 1.44 1.44 1.44 1.44 1.44 1.44 1.44 1.44 1.44 1.44 1.44 1.44 1.45 1.45 1.45 1.45 1.45 1.45 1.45 1.45 1.45 1.45 1.45 1.45 1.45 1.45 1.45 1.45 1.45 1.45 1.45 1.45 1.46 1.46 1.46 1.46 1.46 1.46 1.46 1.46 1.46 1.46 1.46 1.46 1.46 1.46 1.46 1.46 1.47 1.46 1.46 1.46 1.46 1.46 1.46 1.46 1.47 1.47 1.47 1.47 1.47 1.47 1.47 1.47 1.47 1.47 1.47 1.47 1.47 1.47 1.47 1.47 1.47 1.47 1.47 1.47 1.47 1.47 1.47 1.47 1.47 1.48 1.48 1.47 1.47 1.47 1.47 1.47 1.47 1.48 1.48 1.48 1.48 1.48 1.48 1.48 1.48 1.48 1.48 1.48 1.48 1.48 1.48 1.48 1.48 1.48 1.48 1.48 1.48 1.48 1.48 1.48 1.48 1.48 1.48 1.48 1.49 1.48 1.48 1.48 1.48 1.48 1.48 1.48 1.48 1.49 1.49 1.49 1.49 1.49 1.49 1.49 1.49 1.49 1.49 1.49 1.49 1.49 1.49 1.49 1.49 1.49 1.49 1.49 1.49 1.49 1.49 1.49 1.49 1.49 1.49 1.49 1.49 1.49 1.49 1.49 1.49 1.49 1.49 1.49 1.49 1.49 1.49 1.49 1.49 1.49 1.49 1.49 1.49 1.49 1.49 1.49 1.49 1.50 1.50 1.50 1.49 1.49 1.50 1.50 1.50 1.50 1.50 1.50 1.50 1.50 1.50 1.50 1.50 1.50 1.50 1.50 1.50 1.50 1.50 1.50 1.50 1.50 1.50 1.50 1.50 1.50 1.50 1.50 1.50 1.50 1.50 1.50 1.50 1.50 1.50 1.50 1.50];

% Velocity transfer function
sys = tf([K*sig], [1 sig]);

figure(1)
hold on
step(sys)
plot(time,v,'Color','r')
xlim([0 2])
xlabel('time'); ylabel('Angular Velocity (rad/s)');
legend('Simulated','Experimental','location','southeast');

hold off

% Position transfer function (equal to velocity transfer function
% multiplied by 1/s)
sys2 = tf([K*sig], [1 sig 0]);

figure(2)
hold on
step(sys2)
plot(time,posAngular,'Color','r')
xlabel('time'); ylabel('Angular Position (rad)');
xlim([0 2])
legend('Simulated','Experimental','location','northwest');

% From the step response plots, we can see that using the methods stated
% above provides a decent approximation of the system's transfer function.
% The values of K and sigma were 1.50 and 7.142, respectively. A motor
% voltage of 1V was used in this experiment, so K did not need to be
% scaled. In order to find a more accurate representation of this system, a
% PI controller was added in a closed loop step response experiment in the
% next step.
 


